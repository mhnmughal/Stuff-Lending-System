/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'application'
    id 'checkstyle'
    id "com.github.spotbugs" version "6.0.0-beta.3"
}

spotbugsMain {
    ignoreFailures = true // Handle failures via automatic testing
    showStackTraces = true
    reports {
        xml.required.set(true)
        xml.destination = file("$buildDir/reports/spotbugs/spotbugs.xml")
    }
}

// Exclude running spotbugs on unit tests
spotbugsTest {
    ignoreFailures = true
    showStackTraces = false
    enabled = true
}

checkstyle {
    toolVersion = '8.38'
    configFile = rootProject.file('config/checkstyle/google_checks.xml')
    sourceSets = [] // Only run checkstyle on specific calls (e.g., gradlew checkStyleMain)
}

repositories {
    mavenCentral()
}

dependencies {
    // Explicitly declare JUnit Jupiter for testing
    testImplementation 'org.junit.jupiter:junit-jupiter:5.9.2'

    // Other dependencies
    implementation 'com.google.guava:guava:30.1.1-jre'
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(11)
    }
}

application {
    mainClass = 'controller.App'
}

run {
    standardInput = System.in
}

tasks.named('test') {
    dependsOn checkstyleMain, spotbugsMain
    useJUnitPlatform()
}

test {
    dependsOn checkstyleMain, spotbugsMain
    testLogging {
        outputs.upToDateWhen { false }
        showStandardStreams = true
    }
    useJUnitPlatform() // Explicitly specify JUnit platform for tests
}
